# Home Assistant Configuration - House Location
# GitOps managed via Git Pull add-on

# Basic Home Assistant configuration
homeassistant:
  # Name of the location
  name: "House"
  # Location coordinates (Prague defaults - update secrets.yaml with real values)
  latitude: !secret house_latitude
  longitude: !secret house_longitude
  elevation: !secret house_elevation
  # Unit system and locale
  unit_system: metric
  country: CZ
  time_zone: Europe/Prague
  currency: CZK
  # Core shared packages
  packages: !include_dir_named ../../core/packages
  # Location customizations
  customize: !include customize.yaml

# Loads default set of integrations except USB discovery (prevents ZHA auto-discovery)
# We use Zigbee2MQTT instead of ZHA for the SONOFF dongle
default_config:
  exclude:
    - usb

# Load frontend themes from the themes folder  
frontend:
  themes: !include_dir_merge_named themes

# Note: MQTT integration is configured via UI (Settings > Devices & Services)
# The Zigbee2MQTT add-on will automatically configure MQTT discovery

# Core configuration files
automation: !include automations.yaml
script: !include scripts.yaml  
scene: !include scenes.yaml

# HomeKit Integration - Single Consolidated Bridge
homekit:
  - name: "House Main"
    port: 21064
    safe_mode: true
    filter:
      include_entities:
        # CO2 Sensor (bedroom)
        - sensor.bedroom_co2_sensor_co2
        - sensor.bedroom_co2_sensor_temperature
        - sensor.bedroom_co2_sensor_humidity
        # Food Storage Sensor (kitchen)
        - sensor.food_storage_sensor_temperature
        - sensor.food_storage_sensor_humidity
        - sensor.food_storage_sensor_pressure
        - sensor.food_storage_sensor_battery
        # Living Room Light
        - light.living_room_light
        # LED Strip (friendly name format)
        - light.bedroom_led_strip
        # Leak Sensors (water detection)
        - binary_sensor.downstairs_bathroom_leak_sensor
        - binary_sensor.upstairs_bathroom_leak_sensor
        - binary_sensor.kitchen_sink_leak_sensor
        - binary_sensor.laundry_room_leak_sensor
        # Smart Plugs (power control)
        - switch.workshop_smart_plug
        - switch.living_room_pc_smart_plug
        - switch.laundry_room_smart_plug
    entity_config:
      sensor.bedroom_co2_sensor_co2:
        name: "Bedroom CO2"
      sensor.bedroom_co2_sensor_temperature:
        name: "Bedroom Temperature (CO2)"
      sensor.bedroom_co2_sensor_humidity:
        name: "Bedroom Humidity (CO2)"
      sensor.food_storage_sensor_temperature:
        name: "Kitchen Food Storage Temperature"
      sensor.food_storage_sensor_humidity:
        name: "Kitchen Food Storage Humidity"
      sensor.food_storage_sensor_pressure:
        name: "Kitchen Food Storage Pressure"
      sensor.food_storage_sensor_battery:
        name: "Kitchen Sensor Battery"
      light.living_room_light:
        name: "Living Room Light"
      light.bedroom_led_strip:
        name: "Bedroom LED Strip"
      # Leak Sensors (configured as contact sensors for HomeKit compatibility)
      binary_sensor.downstairs_bathroom_leak_sensor:
        name: "Downstairs Bathroom Leak"
        device_class: "opening"
      binary_sensor.upstairs_bathroom_leak_sensor:
        name: "Upstairs Bathroom Leak"
        device_class: "opening"
      binary_sensor.kitchen_sink_leak_sensor:
        name: "Kitchen Sink Leak"
        device_class: "opening"
      binary_sensor.laundry_room_leak_sensor:
        name: "Laundry Room Leak"
        device_class: "opening"
      # Smart Plugs
      switch.workshop_smart_plug:
        name: "Workshop Plug"
      switch.living_room_pc_smart_plug:
        name: "Living Room PC Plug"
      switch.laundry_room_smart_plug:
        name: "Laundry Room Plug"

# Shell commands for GitOps deployment
shell_command:
  deploy_zigbee2mqtt_config: >
    cp /config/zigbee2mqtt_configuration.yaml /config/zigbee2mqtt/configuration.yaml

# Recorder configuration for database optimization
recorder:
  db_url: "sqlite:////config/home-assistant_v2.db"
  purge_keep_days: 30
  include:
    domains:
      - sensor
      - light
      - switch
      - binary_sensor
      - automation
      - person
      - device_tracker
      - input_number
      - input_boolean
  exclude:
    entity_globs:
      - sensor.*_linkquality
      - sensor.*_voltage
      - sensor.*_update_state
      - sensor.home_assistant_*
      - sensor.*_cpu_percent
      - sensor.*_memory_percent

# Logger configuration
logger:
  default: info
  logs:
    homeassistant.components.mqtt: debug
    homeassistant.components.automation: info