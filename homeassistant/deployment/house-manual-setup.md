# House Location - Complete Setup Guide

This guide walks you through setting up your House location with Home Assistant OS, GitOps configuration management, and all connected devices.

## Prerequisites

- ‚úÖ Home Assistant OS installed on Intel NUC 7
- ‚úÖ Git Pull add-on installed and configured
- ‚úÖ Network connectivity and SSH access

## Step 1: Deploy Configuration via GitOps

1. **Configure Git Pull Add-on**:
   - Repository: `https://github.com/etancik/home-automation.git`
   - Branch: `ha-config-house`
   - Deployment path: `/config`

2. **Run Git Pull**: Configuration will be automatically deployed

## Step 2: Create Required Secrets

**Create secrets.yaml** in `/config` directory:
```bash
nano /config/secrets.yaml
```

**Add your location-specific secrets**:
```yaml
# House Location Coordinates
house_latitude: YOUR_LATITUDE_HERE
house_longitude: YOUR_LONGITUDE_HERE
house_elevation: YOUR_ELEVATION_HERE

# MQTT Integration Password (auto-generated by HA)
mqtt_password: "YOUR_MQTT_PASSWORD_HERE"
```

## Step 3: Configure MQTT Device Access

**Add device users to Mosquitto broker**:
1. **Settings** ‚Üí **Add-ons** ‚Üí **Mosquitto broker** ‚Üí **Configuration**
2. **Update the logins section**:
   ```yaml
   logins:
     - username: esplan_user
       password: YOUR_DEVICE_PASSWORD_HERE
   ```
3. **Save and restart** the Mosquitto add-on

## Step 4: Set Up Hardware Devices

### Zigbee2MQTT (Zigbee Devices)
- **SONOFF Zigbee 3.0 USB Dongle Plus V2** already connected
- **Zigbee2MQTT add-on** configured and running
- **Devices**: Food storage sensor, Living room light

### CO2 Sensors (ESP32/ESPlan)
- **Flash device** with `device_config.h` configured for:
  - MQTT server: Your Home Assistant IP
  - Credentials: `esplan_user` / `YOUR_DEVICE_PASSWORD_HERE`
- **Power on**: Device auto-discovers via MQTT

## Step 5: Configure Integrations

### MQTT Integration
- **Auto-configured** via Mosquitto add-on discovery
- **Discovery enabled** for automatic device detection

### HomeKit Integration  
- **Single consolidated bridge**: "House Main" (port 21064)
- **Included devices**: CO2 sensor, food storage sensor, living room light
- **iOS setup**: Scan QR code to add bridge

## Step 6: Verify Complete Setup

### Check Device Status
- **Settings** ‚Üí **Devices & Services** ‚Üí **MQTT**: All devices online
- **Developer Tools** ‚Üí **States**: Verify entity states updating

### Test Automations
- CO2 monitoring alerts functional
- Device customizations applied
- HomeKit bridge accessible from iOS

## Expected Final State

‚úÖ **GitOps Deployment**: Automatic configuration updates  
‚úÖ **Device Discovery**: All sensors auto-detected  
‚úÖ **MQTT Communication**: Secure device authentication  
‚úÖ **HomeKit Integration**: Single bridge with all devices  
‚úÖ **Monitoring**: CO2 alerts and device status tracking  

## Maintenance

### Configuration Updates
- **Git commits** automatically deploy via Git Pull add-on
- **No manual file editing** required on Home Assistant

### Adding New Devices
- **Zigbee devices**: Pair via Zigbee2MQTT interface
- **MQTT devices**: Configure with `esplan_user` credentials
- **Update customize.yaml** via Git for device naming

## Architecture Benefits

üîÑ **Version Control**: All configuration in Git  
üöÄ **Automated Deployment**: Git Pull add-on handles updates  
üîí **Secure MQTT**: Device authentication and encryption  
üì± **iOS Integration**: Single HomeKit bridge for clean experience  
üè† **Multi-Location Ready**: Core patterns shared between house and flat